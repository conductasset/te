<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body { font-family: sans-serif; margin: 20px; }
      .form-group { margin-bottom: 15px; }
      label { display: block; margin-bottom: 5px; font-weight: bold; }
      input, select, textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
      }
      .error-message { color: #b91c1c; font-size: 0.9em; margin-top: 3px; }
      .success-message { color: #16a34a; font-size: 1em; margin-top: 10px; }
      .form-row { display: flex; gap: 20px; }
      .form-row > .form-group { flex: 1; }
      @media (max-width: 600px) {
        .form-row { flex-direction: column; gap: 0; }
      }
    </style>
    <script>
      function validatePlate(plate) {
        // Formato Mercosul: 3 letras, 1 número, 1 letra, 2 números (ex: ABC1D23)
        return /^[A-Z]{3}[0-9][A-Z][0-9]{2}$/.test(plate.toUpperCase());
      }
      function submitForm() {
        var plate = document.getElementById('plate').value.trim().toUpperCase();
        var model = document.getElementById('model').value.trim();
        var year = document.getElementById('year').value.trim();
        var type = document.getElementById('type').value;
        var capacity = parseInt(document.getElementById('capacity').value);
        var obs = document.getElementById('obs').value.trim();

        var plateError = document.getElementById('error-plate');
        plateError.innerText = '';
        if (!validatePlate(plate)) {
          plateError.innerText = 'Placa inválida. Use o formato Mercosul (ex: ABC1D23).';
          return false;
        }

        google.script.run
          .withSuccessHandler(function(){
            document.getElementById('msg').innerText = 'Veículo cadastrado com sucesso!';
            document.getElementById('msg').className = 'success-message';
            updateDashboard();
            document.getElementById('vehicleForm').reset();
          })
          .withFailureHandler(function(error){
            document.getElementById('msg').innerText = 'Erro ao cadastrar: ' + error.message;
            document.getElementById('msg').className = 'error-message';
          })
          .registerVehicle(plate, model, capacity, year, type, obs);
        return false;
      }
      function updateDashboard() {
        google.script.run
          .withSuccessHandler(function(html){
            document.getElementById('dashboard').innerHTML = html;
          })
          .getDashboard();
      }
      window.onload = updateDashboard;
    </script>
  </head>
  <body>
    <h2>Cadastro de Veículo</h2>
    <form id="vehicleForm" onsubmit="return submitForm();">
      <div class="form-row">
        <div class="form-group">
          <label for="plate">Placa</label>
          <input type="text" id="plate" maxlength="7" required placeholder="ABC1D23">
          <div class="error-message" id="error-plate"></div>
        </div>
        <div class="form-group">
          <label for="model">Modelo</label>
          <input type="text" id="model" required placeholder="Ex: VW Gol">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="capacity">Capacidade Total</label>
          <input type="number" id="capacity" min="1" required placeholder="Ex: 40">
        </div>
      </div>
      <input type="submit" value="Cadastrar Veículo">
    </form>
    <div id="msg"></div>
    <hr>
    <div id="dashboard"></div>
  </body>
</html>
          </select>
        </div>
        <div class="form-group">
          <label for="capacity">Capacidade</label>
          <input type="number" id="capacity" min="1" required placeholder="Ex: 40">
        </div>
      </div>
      <div class="form-group">
        <label for="obs">Observações</label>
        <textarea id="obs" rows="2" placeholder="Informações adicionais"></textarea>
      </div>
      <input type="submit" value="Cadastrar Veículo">
    </form>
    <div id="msg"></div>
    <hr>
    <div id="dashboard"></div>
  </body>
</html>
